# 設計決定ログ

1つ以上の設計セッション中に、アジャイルプロジェクトの開始時にすべての要件を把握できるわけではありません。初期のアーキテクチャ設計は、プロジェクト中に進化または変更される可能性があります。特に、可能なテクノロジの選択肢が複数ある場合はそうです。大きなドキュメント内でこれらの変更を追跡することは、ほとんどの場合理想的ではありません。その時点で行われた設計変更を見落とす可能性があるためです。特定のコンテンツを見つけるために大きなドキュメントをスキャンする必要があるのは時間がかかり、多くの場合、決定の結果はドキュメント化されていません。

## 設計上の決定を追跡することが重要なのはなぜですか

アーキテクチャ設計の決定を追跡することには、多くの利点があります。

- 開発者とプロジェクトの利害関係者は、チームの構成が時間の経過とともに変化しても、意思決定ログを確認して変更を追跡できます。
- ログは最新の状態に保たれます。
- チームへの影響を含む決定のコンテキストは、決定とともに文書化されます。
- 大きなドキュメントを読むよりも、ログで設計上の決定を見つける方が簡単です。

## 決定を追跡するための推奨フォーマットは何ですか

プロジェクトの全体的な設計ドキュメントの更新として設計決定を組み込むことに加えて、Michael Nygardがブログで提案したように、決定は[アーキテクチャ決定レコード](http://thinkrelevance.com/blog/2011/11/15/documenting-architecture-decisions)として追跡できます。

設計レビューとディスカッションに投資される労力は、プロジェクトの過程全体で異なる可能性があります。競合するテクノロジーの詳細な比較を行わなくても、意思決定が迅速に行われる場合があります。場合によっては、[Trade Studies](../trade-studies/README.md)のドキュメントに記載されているように、長所と短所についてより詳細な調査を行う必要があります。その他の場合は、[エンジニアリング実現可能性スパイク](../recipes/engineering-feasibility-spikes.md)を実施すると役立つ場合があります。ADRは、これらのさまざまなアプローチのそれぞれを組み込むことができます。

### アーキテクチャ決定記録（ADR）

アーキテクチャ決定レコードには構造があります

- **[昇順の番号]. [決定のタイトル]**

    *タイトルは、何が決定されたかについての情報を読者に与える必要があります。*

    例：

    > *001.SerilogおよびApplicationInsightsを使用したアプリレベルのロギング*

- **日付:**

    *決定がなされた日付。*

- **ステータス：**
     提案/承認/非推奨/置き換え

    *提案された設計は、承認する前に開発チームがレビューできます。以前の決定は、新しい決定に取って代わられるか、またはそれがもはや有効でない場合に非推奨としてマークされたADRレコードに取って代わられる可能性があります。*

- **環境：**

    *このテキストは、読者に問題の理解を提供するか、Michael Nygardが言うように、戦力の価値に中立な[客観的]説明を提供する必要があります。*

    例：

    > *プラットフォームのマイクロサービス設計により、使用状況、パフォーマンス、エラーなどの追跡をエンドツーエンドで実行できるように、各サービス全体でログの一貫性を確保する必要があります。これを実現するために、可能な場合は単一のロギング/モニタリングフレームワークを使用する必要がありますが、後の段階で他のツールに統合/エクスポートするための柔軟性を確保します。開発者は、メッセージとメトリックをログに記録するためのシンプルなインターフェイスを備えている必要があります。*

    *開発チームが意思決定を裏付けるデータ主導のアプローチを持っていた場合、つまり、[貿易研究](../trade-studies/README.md)のガイダンスに従って一連の客観的基準に対して潜在的な選択肢を評価する研究の場合、このセクションで研究を参照する必要があります。*  

- **決断：**

    *決定は、「私たちは...」または「私たちは同意しました...」で始まる必要があります*。

    例：

    > *Serilogをアプリケーションレベルで選択するDotnetLoggingフレームワークとして利用し、分析のためにLogAnalyticsおよびApplicationInsightsに統合することに同意しました。*

- **結果：**

    *決定を適用した後の結果のコンテキスト。*

    例：

    > *サンプリングは、数百万のメッセージを取り込むときに過度に高価にならないように、また重要な情報のキャプチャを妨げないように、ApplicationInsightsで構成する必要があります。チームは、ノイズと不要なレベルのサンプリングを減らすために、設計レビューの一部として監視に不可欠であると合意されたものだけをログに記録する必要があります。*

### ADRを保管する場所

ADRは、gitなどの任意のバージョン管理システムに保存および追跡できます。推奨される方法として、ADRは、メインブランチとのマージが承認されるように更新されるまで、チームによって議論される *提案された* ステータスのプルリクエストとして追加できます。これらは通常、フォルダー構造 *doc/adr* または *doc/arch* に保存されます。さらに、ADRを`decision-log.md`に書き込み、追跡して、わかりやすい形式で有用なメタデータを提供すると便利な場合があります。

#### 決定ログ

決定ログは、ADRに含まれる決定のエグゼクティブサマリーとその他のメタデータを提供するテーブルを含むマークダウンファイルです。テンプレートテーブルは[`doc/decision-log.md`](doc/decision-log.md)で確認できます。

### ADRを追跡するタイミング

アーキテクチャ設計の決定は、通常、構築しているソリューションまたはフレームワークの構造と特性に影響を与える重要な決定が行われるたびに追跡されます。ADRは、さまざまなテクノロジーの選択を評価する際のスパイクの結果を文書化するためにも使用できます。

## ADRの例

最初のADRは、設計上の決定を追跡するためにADRを使用するという決定である可能性があります。

- [0001-record-architecture-decisions.md](doc/adr/0001-record-architecture-decisions.md),

上記の例のように、エンゲージメントの実際の決定が続きます。

- [0002-app-level-logging.md](doc/adr/0002-app-level-logging.md).

# REST API 設計ガイダンス

## 目標

* Microsoftが公開している[REST API 設計ガイドライン](https://github.com/microsoft/api-guidelines)を引き上げます。
* 設計時に考慮すべき一般的な設計上の決定と要因を強調します。
* Microsoftガイドラインで直接扱われていない領域で、API設計に情報を提供するための追加のリソースを提供します。

## 一般的なAPI設計の決定

[Microsoft REST APIガイドライン](https://github.com/microsoft/api-guidelines)は、多数のユースケースをカバーする設計ガイダンスを提供します。
次のセクションは、REST API設計で考慮が必要になる可能性があるため、開始するのに適しています。

* [URL構造](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#71-url-structure)
* [HTTPメソッド](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#74-supported-methods)
* [HTTPステータスコード](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#711-http-status-codes)
* [コレクション](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#9-collections)
* [JSON標準化](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#11-json-standardizations)
* [バージョニング](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#12-versioning)
* [ネーミング](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#17-naming-guidelines)

## APIコントラクトの作成

さまざまな開発チームがさまざまなRESTベースのサービスにアクセスするためにAPIを公開しているため、APIのプロデューサーとコンシューマーの間で共有するAPI契約を結ぶことが重要です。[Open API](https://www.openapis.org/)形式は、最も一般的なAPI記述形式の1つです。
このOpenAPIドキュメントは、次の2つの方法で作成できます。

* デザインファースト - チームは、最初にAPIデザインをOpen APIドキュメントとして記述し、後でこのドキュメントを使用してサーバー側のボイラープレートコードを生成することでAPIの開発を開始します。
* コードファースト - チームはサーバー側のAPIインターフェースコード（コントローラー、DTOなど）の記述を開始し、後でそれからAPIドキュメントを生成して開きます。

### デザインファーストアプローチ

デザインファーストのアプローチとは、APIが「第一級市民」として扱われ、プロジェクトに関するすべてが、最終的にこれらのAPIがクライアントによって消費されるという考えを中心に展開することを意味します。そのため、ビジネス要件に基づいて、API開発チームは最初にAPI設計をオープンAPIドキュメントとして記述し始め、利害関係者と協力してフィードバックを収集します。

このアプローチは、プロジェクトが、パートナーによって使用される外部に公開されたAPIのセットを開発することに関するものである場合に非常に役立ちます。このアプローチでは、最初にAPI契約（Open APIドキュメント）に同意して、APIのプロデューサー側とコンシューマー側の両方に明確な期待を作成し、事前に合意されたAPI設計に従って両方のチームが並行して作業を開始できるようにします。

このアプローチの主な利点：

* 初期のAPI設計フィードバック。
* 両方がAPI契約に合意しているため、消費者と生産者の両方に対する明確に確立された期待。
* 開発チームは並行して作業できます。
* テストチームは、APIコントラクトを使用して、ビジネスロジックが導入される前でも初期のテストを作成できます。さまざまなモデル、パス、属性、およびAPIテストの他の側面を確認することで、非常に価値のある入力を提供できます。
* アジャイル開発サイクル中、API定義は段階的な開発変更の影響を受けません。
* APIの設計は、実際の実装の制限やコード構造の影響を受けません。
* サーバー側のボイラープレートコード（コントローラー、DTOなど）は、APIコントラクトから自動生成できます。
* APIプロデューサーチームとコンシューマーチーム間のコラボレーションを改善する可能性があります。

デザインファースト開発の計画：

1. APIが提供する必要のあるユースケースと主要なサービスを特定します。
2. APIの主要な利害関係者を特定し、APIの設計段階でそれらを含めて、継続的なフィードバックを得るようにしてください。
3. APIコントラクト定義を記述します。
4. APIステータスコード、バージョン管理、エラー応答などの一貫したスタイルを維持します。
5. プルリクエストを介してピアレビューを奨励します。
6. APIコントラクト定義からサーバー側のボイラープレートコードとクライアントSDKを生成します。

考慮すべき重要なポイント：

* API要件が初期開発フェーズで頻繁に変更される場合、設計優先のアプローチは適切ではない可能性があります。これにより、追加のオーバーヘッドが発生し、APIコントラクト定義の更新とメンテナンスを繰り返す必要があります。
* 特定のプラットフォーム固有のコードジェネレーターが生成できない可能性があるため、最初にプラットフォーム固有のコードジェネレーターを試して、プロジェクトの要件とコーディングガイドラインを満たすためにさらに多くの作業が必要になるかどうかを評価することは価値があります。実際のコードの柔軟で保守可能な実装。たとえば、Webフレームワークでコントローラークラスにアノテーションを含める必要がある場合（APIのバージョン管理や認証など）、使用するコード生成ツールがアノテーションを完全にサポートしていることを確認してください。

### コードファーストアプローチ

コードファーストアプローチとは、開発チームが最初にサーバー側のAPIインターフェースコード（コントローラー、DTOなど）を実装し、それからAPIコントラクト定義を生成することを意味します。現在、このアプローチは、デザインファーストアプローチよりも開発者コミュニティ内で広く普及しています。

このアプローチには、チームがAPIを迅速に実装できるようにするだけでなく、予期しないAPI要件の変更に非常に迅速に対応できる柔軟性を提供するという利点があります。

このアプローチの主な利点：

* 開発チームとしてのAPIの迅速な開発は、主要な要件とユースケースを理解した直後に、はるかに迅速にAPIの実装を開始できます。
* 開発チームは、プロジェクト構造に最適な方法でサーバー側APIインターフェイスを実装するための、より優れた制御と柔軟性を備えています。
* 開発チームの間で人気が高いため、関連するトピックについてコンセンサスを得るのが簡単で、実際のコードからOpenAPI定義を生成する方法に関するさまざまなブログや開発者フォーラムで利用できるコード例をすぐに使用できます。
* APIプロデューサーとコンシューマーの両方の要件が頻繁に変更される可能性がある開発の初期段階では、このアプローチは、そのような変更に迅速に対応する柔軟性を提供するため、より優れています。

考慮すべき重要なポイント：

* 生成されたOpenAPI定義は古くなる可能性があるため、自動チェックを行って、生成されたクライアントSDKが同期しなくなり、APIコンシューマーに問題が発生する可能性を回避することが重要です。
* アジャイル開発では、ランタイムコードに埋め込まれた定義が安定していることを保証するのは困難です。特に、リファクタリングのラウンド全体で、複数の同時APIバージョンを提供する場合はそうです。
* Open API定義を定期的に生成してバージョン管理システムに保存すると便利な場合があります。そうしないと、実行時にOpenAPI定義を生成すると、開発/CI時にその定義が必要なシナリオで複雑になる可能性があります。

## ガイドラインを解釈して適用する方法

APIガイドラインドキュメントには、APIが新規か既存かに応じて[ガイドラインを適用する方法](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#4-interpreting-the-guidelines)に関するセクションが含まれています。特に、既存のAPIエコシステムで作業する場合は、特定のベストプラクティスを実装することの影響を理解するために、[重大な変更](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#123-definition-of-a-breaking-change)を構成するものの定義について利害関係者と調整するようにしてください。

> コンプライアンスのためだけに、これらのガイドラインより前のサービスに重大な変更を加えることはお勧めしません。

## 追加リソース

* [REST APIに関するMicrosoftの推奨読書リスト](https://github.com/microsoft/api-guidelines/blob/vNext/Guidelines.md#31-recommended-reading)
* [詳細なHTTPステータスコード定義](https://www.restapitutorial.com/httpstatuscodes.html)
* [セマンティックバージョニング](https://semver.org/)
* [その他のパブリックAPIガイドライン](http://apistylebook.com/design/guidelines/)
* [OpenAPI設計プラクティス](https://oai.github.io/Documentation/best-practices.html)

# 統合テスト

※ オリジナル: https://microsoft.github.io/code-with-engineering-playbook/automated-testing/integration-testing/

統合テストは、個別に開発されたコンポーネントまたはシステムのモジュールが相互に通信する方法を決定するために使用されるソフトウェアテスト方法です。このテスト方法では、システムの集合体またはサブシステムが正しく連携するか、2つ以上のコードユニット間で誤った動作が発生することを確認します。

## 統合テストを行う理由

システムの1つのコンポーネントは独立して開発される場合もあれば、別のコンポーネントとは別に開発される場合もあるため、一部またはすべてのコンポーネントの相互作用を検証することが重要です。複雑なシステムは、データベース、API、インターフェースなどで構成されている場合があり、これらはすべて相互に作用するか、追加の外部システムと相互作用します。統合テストでは、データベーススキーマの破損やサードパーティのAPI統合の欠陥などのシステムレベルの問題が明らかになります。これにより、より高いテストカバレッジが保証され、開発全体を通じて重要なフィードバックループとして機能します。

## 統合テストの設計ブロック

ログイン、転送、現在の残高の3つのモジュールを備えた銀行アプリケーションについて考えてみます。これらはすべて独立して開発されています。統合テストでは、ユーザーがログインすると、特定の模擬ユーザーの正しい金額で現在の残高にリダイレクトされることを確認できます。別の統合テストでは、指定された金額の送金が実行される場合があります。テストでは、口座に送金を実行するのに十分な資金があることを確認できます。送金後、現在の残高は模擬ユーザーに合わせて適切に更新されます。転送モジュールのテスト時にこのモジュールが完了していない場合、ログインページはテストユーザーとモック資格情報でモックされる可能性があります。

統合テストは、開発者またはQAテスターに​​よって行われます。これまで、統合テストは常にユニットの後、システムおよびE2Eテストの前に行われました。単体テストと比較すると、統合テストは量が少なく、通常は実行速度が遅く、セットアップと開発に費用がかかります。現在、チームがアジャイルの原則に従っている場合、統合テストは、順次プロセスを待つ必要がないため、単体テストの前または後に、早い段階で頻繁に実行できます。さらに、統合テストでは、システム全体をシミュレートするためにモックデータを利用できます。開発ライフサイクル全体で使用できる言語固有のテストフレームワークが豊富にあります。

\*\* 統合テストと受け入れテストの違いに注意することが重要です。統合テストでは、コンポーネントのグループが技術的な観点から意図したとおりに機能することを確認し、受け入れテストでは、コンポーネントのグループがビジネスシナリオで意図したとおりに機能することを確認します。

## 統合テストの適用

統合テストを作成する前に、エンジニアはシステムのさまざまなコンポーネント、およびそれらの意図された動作と入力および出力を特定する必要があります。プロジェクトのアーキテクチャは、完全に文書化されているか、簡単に参照できる場所で指定されている必要があります（アーキテクチャ図など）。

統合テストには、主に2つの手法があります。

### ビッグ・バン

ビッグバン統合テストは、すべてのコンポーネントが単一のユニットとしてテストされる場合です。システムが大きすぎると、失敗したテストによる潜在的なエラーを特定するのが難しい場合があるため、これは小規模なシステムに最適です。このアプローチでは、テスト対象のシステム内のすべてのコンポーネントを完了する必要があり、テストの開始時に遅延する可能性があります。

![Big Bang Integration Testing](./images/bigBang.jpg)

### インクリメンタルテスト

インクリメンタルテストとは、論理的に関連する2つ以上のコンポーネントを1つのユニットとしてテストすることです。ユニットをテストした後、追加のコンポーネントを組み合わせて、すべて一緒にテストします。このプロセスは、必要なすべてのコンポーネントがテストされるまで繰り返されます。

#### トップダウン

トップダウンテストは、ソフトウェアシステムの制御フローに従って上位レベルのコンポーネントをテストする場合です。このシナリオでは、一般にスタブと呼ばれるものを使用して、統合テストでまだ完了していない、またはマージされていない下位レベルのモジュールの動作をエミュレートします。

![Top Down Integration Testing](./images/topDown.png)

#### ボトムアップ

ボトムアップテストは、下位レベルのモジュールを一緒にテストする場合です。このシナリオでは、一般にドライバーと呼ばれるものを使用して、まだ完了していない、または統合テストに含まれていない高レベルのモジュールの動作をエミュレートします。

![Bottom Up Integration Testing](./images/bottomUp.jpg)

サンドイッチまたはハイブリッドモデルとして知られる3番目のアプローチは、ボトムアップアプローチとタウンダウンアプローチを組み合わせて、下位レベルと上位レベルのコンポーネントを同時にテストします。

### 避けるべきこと

開発者が統合テストコードカバレッジとエンジニアリングサイクルの間で行わなければならないトレードオフがあります。模擬の依存関係、テストデータ、およびテスト中の複数の環境では、統合テストが多すぎると維持できなくなり、意味がなくなります。モックが多すぎると、テストスイートの速度が低下し、スケーリングが困難になります。これは、開発者が受け入れやE2Eなどのシナリオの他のテストを検討する必要がある兆候である可能性があります。

複雑なシステムの統合テストには、高度なメンテナンスが必要です。テストスイートを分離しておくことにより、統合テストでビジネスロジックをテストすることは避けてください。タスクの受け入れ基準を超えてテストしないでください。また、特定のテスト用に作成されたリソースを必ずクリーンアップしてください。さらに、実稼働環境でテストを作成することは避けてください。代わりに、縮小されたコピー環境でそれらを記述してください。

## 統合テストのフレームワークとツール

多くのツールとフレームワークを使用して、ユニットテストと統合テストの両方を作成できます。次のツールは、統合テストを自動化するためのものです。

- [JUnit](https://junit.org/junit5/)
- [Robot Framework](https://robotframework.org/)
- [moq](https://github.com/moq/moq4)
- [Cucumber](https://cucumber.io/)
- [Selenium](https://www.selenium.dev/)
- [Behave (Python)](https://behave.readthedocs.io/en/latest/tutorial.html)

## 結論

統合テストは、システムの1つのモジュールまたは外部システムが別のモジュールとどのようにインターフェースするかを示します。これは、サブシステム、システム全体、またはシステムのコレクションの2つのコンポーネントのテストになります。テストは、適切な量のモックされた依存関係とテストデータを使用して、開発ライフサイクル全体を通じて頻繁に作成する必要があります。統合テストは、独立して開発されたモジュールが技術的に設計されたとおりにインターフェースすることを証明するため、開発サイクルの信頼性を高め、展開および拡張するシステムへのパスを提供します。

## 参考資料

<!-- markdown-link-check-disable -->
- [統合テストのアプローチ](https://www.softwaretestinghelp.com/what-is-integration-testing/)
<!-- markdown-link-check-enable -->
- [統合テストの長所と短所](https://www.geeksforgeeks.org/software-engineering-integration-testing/)
- [統合テストのモックとスタブ](https://circleci.com/blog/how-to-test-software-part-i-mocking-stubbing-and-contract-testing/)
- [ソフトウェアテスト：原則と実践](https://www.goodreads.com/book/show/21278464-software-testing)
- [統合テスト動作テストのクイックスタート](https://github.com/Nick287/Behave-Quick-Start)

# ユーザーインターフェイスのテスト

※ オリジナル: https://microsoft.github.io/code-with-engineering-playbook/automated-testing/ui-testing/

このセクションは主にWebベースのUIを対象としていますが、ガイダンスはモバイルアプリケーションとOSベースのアプリケーションで同様です。 

## 適用性

UIテストは、常に適用できるとは限りません。たとえば、UIのない​​アプリケーションや、人間の操作を必要としないアプリケーションの一部などです。そのような場合、ユニット、機能、統合/e2eテストが主要な手段になります。UIテストは、主に、多様な環境で使用される公開UIや、より高い忠実度を必要とするミッションクリティカルなUIを扱う場合に適用されます。ほんの一握りの人が使用する管理UIのようなものでは、UIテストは依然として価値がありますが、優先度はそれほど高くありません。

## 目標

UIテストは、ユーザーがさまざまなアクセス手段にわたって一貫した視覚的なユーザーエクスペリエンスを持ち、ユーザーの操作が機能要件と一致していることを確認する機能を提供します。

- UIの外観と相互作用が機能要件と非機能要件を満たしていることを確認します
- デバイスと配信プラットフォームの両方、およびコード変更間のUIの変更を検出します
- デザイナーと開発者に自信を与えるユーザーエクスペリエンスは一貫している
- リグレッションのリスクを軽減しながら、コードの迅速な進化とリファクタリングをサポートします

## 証拠と対策

UIテストをCI/CDに統合することは必要ですが、単体テストよりも困難です。増大する課題は、UIテストを[Puppeteer](https://github.com/puppeteer/puppeteer)のようなものでヘッドレスで実行する必要があるか、[BrowserStack](https://www.browserstack.com/automate/azure)のような完全なテスト統合を処理するAzureDevOpsまたはGitHubとのより広範なオーケストレーションが必要であるということです。

`BrowserStack`のような統合ツールはテスト実行の一部としてAzure DevOpsレポートを提供するため、優れています。

とはいえ、Azure DevOpsはさまざまなテストアダプターをサポートしているため、テスト結果の[テスト結果の公開タスク](https://docs.microsoft.com/en-us/azure/devops/pipelines/tasks/test/publish-test-results?view=azure-devops&tabs=yaml)にリストされている出力形式の1つへのテスト結果の出力をサポートする任意のUIテストフレームワークを使用できます。

Azure DevOpsパイプラインを使用してUIテストを実行している場合は、フレームワークのバージョンを管理し、予期しない更新を回避するために、[セルフホストエージェント](https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/agents?view=azure-devops&tabs=browser)の使用を検討してください。

## 一般的なガイダンス

UIテストの範囲は戦略的である必要があります。UIテストは、実装と実行の両方にかなりの時間がかかる可能性があり、可能な対話の数が多いため、実稼働アプリケーションですべてのタイプのユーザー対話をテストすることは困難です。

機能テストを中心にUIテストを設計することは理にかなっています。たとえば、入力フォームが与えられた場合、UIテストは、視覚的表現がデバイス間で一貫しており、アクセス可能で相互作用可能であり、コード変更全体で一貫していることを確認します。

UIテストは、ユニットテストと機能テストでは検出されない「ランタイム」バグを検出します。たとえば、入力フォームの送信ボタンがレンダリングされているが、UIの位置のバグのためにクリックできない場合、これはユニットテストまたは機能テストでは検出されなかったランタイムバグと見なすことができます。

UIテストは、QAやステージングのように、モックデータまたは本番データのスナップショットで実行できます。

### テストの記述

優れたUIテストは、いくつかの一般的な原則に従います。

- 迅速なフィードバックを可能にし、使いやすいUIテストフレームワークを選択してください
- 簡単にテストできるようにUIを設計します。たとえば、CSSセレクターを追加するか、Webページの要素にIDを設定して、簡単に選択できるようにします。
- 単一のデバイスやOSでテストするだけでなく、ユーザーが使用するすべてのプライマリデバイスでテストします。
- テストでデータを変更する場合は、データがオンデマンドで作成され、後でクリーンアップされることを確認してください。これを行わないと、テストに一貫性がなくなります。 

### 一般的な問題

UIテストは、特にSeleniumのようなテストフレームワークでは、下位レベルで非常に困難になる可能性があります。このルートを選択すると、タイムアウトや要素の欠落が発生する可能性が高く、テストフレームワーク自体との摩擦が大きくなります。UIテストには多くの問題があるため、Seleniumなどのフレームワークの特定の問題を軽減するのに役立つ無料および有料のソリューションがいくつかあります。これが、Seleniumの既知の問題の多くを解決するため、推奨されるフレームワークにCypressが含まれている理由です。

ただし、これは重要なポイントです。選択したUIテストフレームワークに応じて、よりスムーズなテスト作成エクスペリエンス、または非常に苛立たしく時間のかかるテスト作成エクスペリエンスが得られます。セレンだけを選択した場合、開発コストと時間コストは非常に高くなる可能性があります。Selenium上に構築されたフレームワーク、またはSeleniumのようなもので多くの問題を解決しようとするフレームワークのいずれかを使用することをお勧めします。

ヘッドレスで実行する場合、特にWebアプリケーションでは、UIが開発マシンで表示されるものとは異なるレンダリングになる可能性があるため、さらに考慮事項があることに注意してください。さらに、異なるページサイズでレンダリングする場合、CSSルールのために要素がページ上に表示されなくなる可能性があるため、デフォルトのオプションを使用する特定のフレームワークでは選択できないことに注意してください。これらの問題はすべて解決して回避できますが、レンダリングはUIテストの別の特定の課題を示しています。

## 具体的なガイダンス

推奨されるテストフレームワーク:

- ウェブ
  - [BrowserStack](https://www.browserstack.com)
  - [Cypress](https://www.cypress.io)
  - [Jest](https://jestjs.io/docs/en/snapshot-testing)
  - [Selenium](https://www.selenium.dev)
- OS/モバイルアプリケーション
  - [Coded UI tests (CUITs)](https://docs.microsoft.com/en-us/visualstudio/test/use-ui-automation-to-test-your-code?view=vs-2019)
  - [Xamarin.UITest](https://docs.microsoft.com/en-us/appcenter/test-cloud/uitest/)

> 注: 有料の上記のフレームワークはBrowserStackであり、業界標準としてリストされており、残りはオープンソースで無料であることに注意してください。

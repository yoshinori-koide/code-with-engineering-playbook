# コンポーネントのバージョン管理

## ゴール

大規模なアプリケーションは、相互に参照し、コンポーネントのインターフェース/コントラクトの互換性に依存する複数のコンポーネントで構成されます。

疎結合アプリケーションの目標を達成するには、各コンポーネントを個別にバージョン管理する必要があります。これにより、開発者はバージョン番号を確認するだけで、重大な変更やシームレスな更新を検出できます。

## バージョン番号とバージョン管理スキーム

開発者または他のコンポーネントが重大な変更を検出するには、コンポーネントのバージョン番号が重要です。

さまざまなバージョン番号スキームがあります。

`major.minor[.build[.revision]]`

または

`major.minor[.maintenance[.build]]`.

ビルド/CI時に、これらのバージョン番号が生成されます。CD /リリース中、コンポーネントはNuget、NPM、Docker Hubなどのコンポーネントリポジトリにプッシュされ、さまざまなバージョンの履歴が保持されます。

ビルドごとに、バージョン番号が最後の桁でインクリメントされます。

メジャー/マイナーバージョンの更新は、API/インターフェース/コントラクトの変更を示します。

* メジャーバージョン：重大な変更
* マイナーバージョン：下位互換性のあるマイナーな変更
* ビルド/リビジョン：APIの変更はなく、ビルドが異なるだけです。

## セマンティックバージョニング

セマンティックバージョニングは、特定のソースコードリポジトリに基づいてバージョン番号を自動的に計算するという概念です。

この `semver` ツールはGITソース管理ブランチを調べ、に基づいて繰り返し可能で一意のバージョン番号を考え出します。

* 前回のメジャーリリースまたはマイナーリリース以降のコミット数
* メッセージをコミットする
* タグ
* ブランチ名

semverバージョン番号の例：

* **1.0.0-alpha.1**: 1.0.0のアルファリリース *後に* +1コミット +1 commit *after* the alpha release of 1.0.0
* **2.1.0-beta**: ベータブランチの2.1.0
* **2.4.2**: 2.4.2リリース

バージョンの更新は次の方法で行われます。

* メジャー/マイナー/リビジョンの更新のメッセージまたはタグをコミットします。
* Alpha / Beta / RCのブランチ名（例：開発、リリース/ ..）
* それ以外の場合：コミット数（+12、...）

CIプロセス中にsemverを実行して、各ビルドを一意に識別できるようにすることをお勧めします。

## 参照資料

* [セマンティックバージョニング](https://semver.org/)
* [C＃でのバージョン管理](https://docs.microsoft.com/en-us/dotnet/csharp/versioning)
* [Visual Studio Team Services の SemVer タスク](https://marketplace.visualstudio.com/items?itemName=geeklearningio.gl-vsts-tasks-semver)
